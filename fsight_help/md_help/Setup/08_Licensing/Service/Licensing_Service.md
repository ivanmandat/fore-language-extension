# Сервис лицензирования и особенности его использования

Сервис лицензирования и особенности его использования
-


# Сервис лицензирования и особенности
	 его использования


	Сервис лицензирования предназначен для обработки запросов от веб-приложения
	 (BI-сервера) или настольного приложения к серверу лицензий. При работе
	 с продуктом «Форсайт. Аналитическая платформа»
	 запрашиваются требуемые [единицы лицензирования](../AboutFeatures.htm),
	 сервис лицензирования обрабатывает полученные запросы и перенаправляет
	 их к серверу лицензий.


	Сервис лицензирования - это утилита licman со встроенной поддержкой
	 параллельной обработки запросов для программного обеспечения, на базе
	 которого работает сервер лицензий: [Guardant](../Guardant/License_Server_Guardant.htm)
	 или [RMS](../RMS/LicenseServer.htm).


	Примечание.
	 Для получения сервиса лицензирования обратитесь в техническую поддержку
	 по адресу [support@fsight.ru](mailto:support@fsight.ru)
	 или через [сервисы
	 технической поддержки](https://www.fsight.ru/support/), которые доступны после регистрации на сайте.


## Шаг 1. Установка сервиса лицензирования


	Процесс установки сервиса лицензирования зависит от операционной
	 системы. В ОС Linux установка выполняется с помощью дистрибутива,
	 в ОС Windows установка не требуется, достаточно разместить файлы сервиса
	 лицензирования в произвольной папке.


		ОС
		 Linux ОС Windows

			Для установки сервиса лицензирования в ОС Linux:


				- Скопируйте полученный дистрибутив сервиса лицензирования
				 в домашнюю директорию /home/<имя
				 пользователя>:


					- Guardant:


						- foresight-licman_guardant*.deb
						 для Debian-подобных дистрибутивов;


						- foresight-licman_guardant*.rpm
						 для RedHat-подобных дистрибутивов и ALT Linux;


					- RMS:


						- foresight-licman_rms*.deb
						 для Debian-подобных дистрибутивов;


						- foresight-licman_rms*.rpm
						 для RedHat-подобных дистрибутивов и ALT Linux.


				- Установите скопированный дистрибутив сервиса лицензирования:


					- Astra Linux:


			sudo dpkg
			 -i foresight-licman*.deb


					- Rocky Linux:


			sudo yum
			 localinstall foresight-licman*.rpm


					- РЕД ОС:


			sudo dnf
			 install foresight-licman*.rpm


					- ALT Linux:


			sudo apt-get
			 install -y foresight-licman*.rpm


			Примечание.
			 Для установки дистрибутива может использоваться другая утилита.


			После выполнения действий будут созданы:


				- /opt/foresight/licman.
				 Основные файлы сервиса лицензирования: утилита licman
				 и файл конфигурации [settings.json](Licensing_Service_Configuration.htm);


				- /etc/systemd/system/licman.service.
				 Служба licman.service для управления сервисом лицензирования.
				 Служба запускается сразу после установки дистрибутива
				 и работает в фоновом режиме;


				- /var/log/licman/licman.log.
				 Файл, в который записывается отладочная информация, выводимая
				 в процессе работы сервиса лицензирования. Создаётся, если
				 в файле settings.json задано поле [logLevel](Licensing_Service_Configuration.htm#loglevel)
				 со значением «info» или «log»;


				- /var/log/licman/error.log.
				 Файл, в который записываются ошибки, возникающие в процессе
				 работы сервиса лицензирования. Создаётся, если в файле
				 settings.json задано поле [logLevel](Licensing_Service_Configuration.htm#loglevel)
				 со значением «info» или «log». Для получения подробной
				 информации о возможных ошибках, возникающих при работе
				 с Guardant, обратитесь к [официальной
				 документации](https://dev.guardant.ru/pages/viewpage.action?pageId=71485820).


			Для работы со службой licman.service и управления сервисом
			 лицензирования выполните команду:


			sudo systemctl start/restart/stop licman.service


			Для работы с сервисом лицензирования в ОС Windows создайте
			 произвольную папку, например, C:\Licman и разместите полученные
			 файлы сервиса лицензирования:


				- licman_guardant.exe для
				 работы с сервером лицензий на базе Guardant или licman_rms.exe
				 для работы с сервером лицензий на базе RMS;


				- settings.json.


			Папка C:\Licman используется в качестве примера и может
			 отличаться.


## Шаг 2. Предварительная настройка работы сервиса лицензирования
	 по протоколу HTTPS


	По умолчанию сервис лицензирования взаимодействует с продуктом «Форсайт. Аналитическая платформа»
	 по протоколу HTTPS.


	Для предварительной настройки работы сервиса лицензирования по протоколу
	 HTTPS:


		- Подготовьте сертификаты безопасности:


			- корневой сертификат безопасности в формате CRT;


			- сертификат сервера, на котором расположен сервис лицензирования,
			 в формате PEM;


			- закрытый ключ сертификата сервера в формате PEM.


	Сертификаты безопасности включают в себя
	 набор информации о владельце сертификата, открытом ключе владельца
	 сертификата, субъекте, который выпустил и подписал сертификат, а также
	 информацию для проверки сертификата. Каждый сертификат ограничен сроком
	 действия. Сервис лицензирования доступен, если сертификаты действительны
	 на момент его использования. При необходимости обновите сертификаты
	 или продлите их срок действия.


		- Разместите сертификаты безопасности в папке:


			- /opt/foresight/ssl
			 в ОС Linux;


			- C:\Licman в ОС Windows.


		- Импортируйте корневой сертификат в хранилище доверенных
		 корневых центров сертификации в зависимости от операционной системы.


		ОС
		 Linux ОС Windows


			Для импорта корневого сертификата в хранилище доверенных
			 корневых центров сертификации в ОС Linux:


				- Debian-подобные дистрибутивы:


					- Создайте папку fp-licman-certs и скопируйте
					 в неё корневой сертификат безопасности:


			sudo mkdir
			 /usr/share/ca-certificates/fp-licman-certs

			sudo cp <путь до папки>/<наименование сертификата>.crt
			 /usr/share/ca-certificates/fp-licman-certs/fp-licman-ca.crt


			После выполнения действий будет
			 создана папка /usr/share/ca-certificates/fp-licman-certs с
			 корневым сертификатом fp-licman-ca.crt.


					- Откройте на редактирование файл /etc/ca-certificates.conf
					 и добавьте строку в конец файла:


			sudo echo
			 "fp-licman-certs/fp-licman-ca.crt" >> /etc/ca-certificates.conf


					- Примените изменение конфигурации:


			sudo update-ca-certificates
			 -v


				- RedHat-подобные дистрибутивы и ALT Linux:


					- Скопируйте корневой сертификат безопасности
					 в папку /etc/pki/ca-trust/source/anchors:


			sudo cp <путь до папки>/<наименование сертификата>.crt
			 /etc/pki/ca-trust/source/anchors/fp-licman-ca.crt


			После выполнения действия в папке
			 /etc/pki/ca-trust/source/anchors будет содержаться корневой
			 сертификат fp-licman-ca.crt.


					- Примените изменение конфигурации:


			sudo update-ca-trust


			После выполнения действий корневой сертификат будет импортирован
			 в хранилище доверенных корневых центров сертификации.


			Для импорта корневого сертификата в хранилище доверенных
			 корневых центров сертификации средствами ОС Windows:


				- Дважды щёлкните по корневому сертификату *.crt.
				 После чего будет открыто окно «Сертификат».


				- Нажмите кнопку «Установить
				 сертификат». После чего будет открыт мастер импорта
				 сертификатов.


				- Выберите расположение хранилища «Текущий
				 пользователь» и нажмите кнопку «Далее».


				- Установите переключатель «Поместить
				 все сертификаты в следующее хранилище», выберите
				 хранилище сертификатов «Доверенные
				 корневые центры сертификации» и нажмите кнопку
				 «Далее».


			После выполнения действий корневой сертификат будет импортирован
			 в хранилище доверенных корневых центров сертификации.


	Другие варианты установки и импорта сертификата
	 на различных операционных системах и браузерах приведены на [портале государственных услуг](https://www.gosuslugi.ru/crt).


	После выполнения действий будет настроена работа сервиса лицензирования
	 по протоколу HTTPS.


	В шаге 3 при настройке конфигурации сервиса лицензирования в файле
	 [settings.json](Licensing_Service_Configuration.htm) укажите
	 параметры работы сервиса лицензирования по протоколу HTTPS в настройках
	 поля [secure](Licensing_Service_Configuration.htm#secure).


	В шаге 4 при подключении сервиса лицензирования в файле [settings.xml](../../UiWebSetup/03_Setup_Web/BI_Server_Settings_XML.htm)
	 укажите номер порта, по которому доступен сервис лицензирования по
	 протоколу HTTPS, в параметре Port.
	 По умолчанию: 8511.


## Шаг 3. Настройка конфигурации сервиса лицензирования


	Для настройки конфигурации сервиса лицензирования используйте файл
	 [settings.json](Licensing_Service_Configuration.htm), расположенный
	 по умолчанию в папке:


		- /opt/foresight/licman в ОС Linux;


		- C:\Licman в ОС Windows.


	По умолчанию в файле settings.json заданы основные поля [server](Licensing_Service_Configuration.htm#server) и [port](Licensing_Service_Configuration.htm#port)
	 для работы сервиса лицензирования по протоколу HTTP:


	{

	    "server": "localhost",

	    "port": 8510

	}


	Для работы сервиса лицензирования по протоколу HTTPS задайте основные
	 поля [secure](Licensing_Service_Configuration.htm#secure),
	 [server](Licensing_Service_Configuration.htm#server)
	 и [дополнительные
	 поля](Licensing_Service_Configuration.htm#additional) при необходимости.


	Пример файла settings.json:


	{

	    "server": "localhost",

	    "secure":{

	        "port": 8511,

	        "key": "/opt/foresight/ssl/fp_licman_server_key.pem",

	        "cert": "/opt/foresight/ssl/fp_licman_server_cert.pem"

	   }

	}


	Для получения подробной информации о содержимом файла settings.json
	 обратитесь к разделу «[Настройка
	 конфигурации сервиса лицензирования](Licensing_Service_Configuration.htm)».


	Для применения изменения конфигурации сервиса лицензирования в файле
	 settings.json в ОС Linux перезапустите службу licman.service:


	sudo systemctl restart licman.service


## Шаг 4. Подключение сервиса лицензирования


	Для подключения сервиса лицензирования и взаимодействия продукта
	 «Форсайт. Аналитическая платформа»
	 с сервером лицензий через него сформируйте
	 раздел License, содержащий подраздел Service, в файле [settings.xml](../../UiWebSetup/03_Setup_Web/BI_Server_Settings_XML.htm)
	 со следующими параметрами:


		- Active. Признак
		 взаимодействия продукта «Форсайт. Аналитическая платформа»
		 с сервером лицензий через сервис лицензирования. Допустимые значения:


			- True. Продукт
			 «Форсайт. Аналитическая платформа»
			 взаимодействует с сервером лицензий через сервис лицензирования;


			- False. По умолчанию.
			 Продукт «Форсайт. Аналитическая платформа»
			 взаимодействует с сервером лицензий напрямую.


	Примечание.
	 Прямое взаимодействие допустимо только при использовании сервера лицензий
	 на базе [RMS](../RMS/LicenseServer.htm).


	При использовании сервера лицензий на
	 базе [Guardant](../Guardant/License_Server_Guardant.htm)
	 задайте параметру значение True.


		- Secure. Признак
		 работы сервиса лицензирования по протоколу HTTPS. Допустимые значения:


			- True. По умолчанию.
			 Сервис лицензирования работает по протоколу HTTPS;


			- False. Сервис
			 лицензирования работает по протоколу HTTP;


		- Host. IP-адрес или
		 DNS-имя сервиса лицензирования. По умолчанию: localhost;


		- Port. Номер порта,
		 по которому доступен сервис лицензирования:


			- по протоколу HTTPS - 8511. Используется, если параметр
			 Secure принимает значение
			 True. При указании
			 данного порта номер должен совпадать со значением поля [port](Licensing_Service_Configuration.htm#secure),
			 указанного в поле secure,
			 в файле settings.json;


			- по протоколу HTTP - 8510. Используется, если параметр
			 Secure принимает значение
			 False. При указании
			 данного порта номер должен совпадать со значением поля [port](Licensing_Service_Configuration.htm#port),
			 указанного в файле settings.json;


		- TlsVersion. Версия
		 протокола Transport Layer Security (TLS), используемого для создания
		 безопасного канала связи между компьютерами в сети. По умолчанию
		 используется версия 1.2. Рекомендуется использовать версию протокола
		 TLS 1.2 и выше.


	Пример раздела License в settings.xml:


		- при работе сервиса лицензирования
		 по протоколу HTTPS:


	<Key Name="License">

	  <Key Name="Service" Active="True"
	 Host="localhost" Port="8511"/>

	</Key>


		- при работе сервиса лицензирования по протоколу HTTP:


	<Key Name="License">

	  <Key Name="Service" Active="True"
	 Secure="False" Host="localhost" Port="8510"/>

	</Key>


	Для применения параметров подключения сервиса лицензирования в веб-приложении
	 [перезапустите
	 BI-сервер](../../UiWebSetup/01_BIServer/bi-service_restart.htm). Если открыто настольное приложение, то перезапустите
	 его.


## Шаг 5. Запуск сервиса лицензирования


	Для запуска сервиса лицензирования:


		- в ОС Linux запустите или перезапустите службу licman.service:


	sudo systemctl start/restart
	 licman.service


		- в ОС Windows запустите утилиту licman_guardant.exe/licman_rms.exe.


	При запуске сервиса лицензирования проверяется наличие валидного
	 файла [settings.json](Licensing_Service_Configuration.htm):


		- если файл settings.json содержится в одной папке с утилитой
		 licman и является валидным, то используются заданные значения
		 полей;


		- если файл settings.json не содержится в одной папке с утилитой
		 licman или является невалидным, то используются значения полей
		 по умолчанию.


	В процессе работы сервиса лицензирования выводится отладочная информация,
	 если в settings.json задано поле [logLevel](Licensing_Service_Configuration.htm#loglevel)
	 со значением «info» или «log». Для получения подробной информации
	 о возможных ошибках, возникающих при работе с Guardant, обратитесь
	 к [официальной документации](https://dev.guardant.ru/pages/viewpage.action?pageId=71485820).


## Настройка отказоустойчивости сервера
	 лицензий


	Для обеспечения отказоустойчивости основного сервера лицензий доступно
	 подключение серверов, которые будут использоваться в качестве резервных.


	Примечание.
	 Актуально при активации продукта на базе [RMS](../RMS/Activation_Product_RMS.htm).


	Сервис лицензирования обращается к основному серверу лицензий в
	 течение времени, заданного в поле [serverTimeout](Licensing_Service_Configuration.htm#server_timeout).
	 Если заданное время ожидания истекло и сервис лицензирования не получил
	 ответ от сервера лицензий, то выполняется подключение к резервному
	 серверу, следующему после основного в массиве поля [server](Licensing_Service_Configuration.htm#server).
	 После чего сервис лицензирования обращается к основному серверу с
	 периодичностью, заданной в поле [checkServerTime](Licensing_Service_Configuration.htm#check_server_time).
	 Если основной сервер лицензий отвечает на запросы, то выполняется
	 обратное подключение.


	На резервных серверах должна содержаться лицензия с [пробным
	 периодом](../Admin_Licensing_Variants.htm#trial) для обеспечения непрерывной работы пользователей в случае
	 временной недоступности основного сервера лицензий. Лицензия
	 активируется при первом обращении к ней.


	Для подключения резервных серверов лицензий задайте массив в поле
	 [server](Licensing_Service_Configuration.htm#server).
	 При необходимости измените значения [дополнительных
	 полей](Licensing_Service_Configuration.htm#additional).


	Пример заполнения полей в settings.json:


	{

	    "server": ["localhost",
	 "reserveServer"],

	    "port": 8510,

	    "checkServerTime": 15,

	    "logLevel": "log",

	    "serverTimeout": 10,

	    "workersCount": 4,

	    "secure":{

	        "port": 8511,

	        "key": "/opt/foresight/ssl/fp_licman_server_key.pem",

	        "cert": "/opt/foresight/ssl/fp_licman_server_cert.pem"

	    }

	}


## Настройка отказоустойчивости сервиса лицензирования


	Для обеспечения отказоустойчивости сервиса лицензирования при использовании
	 одного BI-сервера или [кластера
	 BI-серверов](../../UiWebSetup/01_BIServer/Cluster/Cluster_Of_BI_Server.htm) настройте балансировщик HAProxy. Для получения подробной
	 информации обратитесь к разделу «[Настройка
	 балансировщика HAProxy при использовании сервиса лицензирования](../../UiWebSetup/01_BIServer/Cluster/License_HAProxy_Settings.htm)».


## Удаление сервиса лицензирования в ОС Linux


	Для удаления файлов сервиса лицензирования в ОС Linux выполните
	 команду:


		- Astra Linux:


	sudo apt-get purge
	 foresight-licman


		- РЕД ОС, Rocky Linux:


	sudo yum purge foresight-licman


		- ALT Linux:


	sudo apt-get remove
	 --purge foresight-licman


	После выполнения действия будет удалены папки /opt/foresight/licman, /var/log/licman
	 и служба /etc/systemd/system/licman.service.


См. также:


[Активация
 продукта «Форсайт. Аналитическая платформа»](../Admin_Licensing.htm)
 | [Сервер лицензий Guardant
 и особенности его использования](../Guardant/License_Server_Guardant.htm) | [Сервер
 лицензий RMS и особенности его использования](../RMS/LicenseServer.htm) | [Настройка
 конфигурации сервиса лицензирования](Licensing_Service_Configuration.htm)


		Справочная
		 система на версию 10.9
		 от 18/08/2025,
		 © ООО «ФОРСАЙТ»,
