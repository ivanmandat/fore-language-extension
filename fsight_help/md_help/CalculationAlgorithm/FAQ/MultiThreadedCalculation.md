# Как выполнять многопоточный расчёт?

Как выполнять многопоточный расчёт?
-


# Как выполнять многопоточный расчёт?


Для ускорения [расчёта
 алгоритма](../Desktop/Work/Perform_calculations.htm) предусмотрена возможность использования многопоточного расчёта,
 позволяющего выполнять расчёт с помощью нескольких потоков, действующих
 одновременно. Для настройки многопоточного расчёта:


	- Установите флажок «Многопоточный
	 расчет» в окне «[Настройка выполнения
	 расчёта](../Desktop/Work/Perform_calculations.htm)».


	- Установите флажок «Многопоточный
	 расчет» на странице «[Приёмник](../Desktop/Calculation_block/Master_calculation_block_page_consumer.htm)»
	 в мастере редактирования [блоков
	 расчёта](../Desktop/Calculation_block/Calculation_unit.htm) и/или [блоков
	 контроля](../Desktop/Control_Block/Control_Block.htm), для которых требуется применить многопоточный расчёт.


В результате при расчёте алгоритма для требуемых блоков расчёта и/или
 контроля будет выполняться многопоточный расчёт. По умолчанию при многопоточном
 расчёте используется максимум 8 потоков. Для изменения максимального числа
 потоков, по которым будет выполняться параллельный расчёт итераций, создайте
 параметр MsNumThreads типа REG_DWORD
 и задайте ему значение в разделе реестра [HKEY_CURRENT_USER\Software\Foresight\Foresight Analytics Platform\10.0\Debug] на локальных
 компьютерах всех пользователей. Если заданное значение параметра меньше
 числа ядер процессора, то будет использоваться число потоков, заданное
 в параметре. Если заданное значение параметра больше числа ядер процессора,
 то будет использоваться число потоков, равное числу ядер.


Примечание.
 При указании параметра MsNumThreads учитывайте
 особенность архитектуры процессора Intel от 2019 года выпуска и выше.
 При расчёте итераций будет использоваться удвоенное число потоков относительно
 заданного значения параметра.


Выполнение многопоточного расчёта происходит в несколько этапов:


	- Инициализация. На этапе
	 инициализации для каждого потока создаётся своя коллекция отметок
	 измерений [источников
	 данных](../Desktop/Calculation_block/Page_Sources.htm) для [блоков
	 расчёта](../Desktop/Calculation_block/Calculation_unit.htm). При однопоточном расчёте коллекция отметок измерений
	 источников данных создаётся только один раз.


Примечание.
 При увеличении числа потоков, участвующих в многопоточном расчёте, увеличивается
 время, требуемое для выполнения этапа инициализации.


	- Расчёт. На этапе расчёта
	 все коллекции отметок измерений источников данных распределяются по
	 потокам, после чего каждый поток выполняет последовательный расчёт
	 алгоритма для каждой отметки из коллекции.


По окончании выполнения действий на каждом этапе многопоточный расчёт
 завершается.


По умолчанию [расчёт
 алгоритма](../Desktop/Work/Perform_calculations.htm) выполняется в однопоточном режиме. Рекомендуется использовать
 однопоточный расчёт, если:


	- при [расчёте
	 алгоритма](../Desktop/Work/Perform_calculations.htm) выполняются несложные арифметические операции и/или
	 выполняются операции над справочниками с большим количеством элементов
	 в отметке. В этом случае при использовании многопоточного расчёта
	 создание коллекций отметок измерений [источников
	 данных](../Desktop/Calculation_block/Page_Sources.htm) может привести к излишним временным затратам, превышающим
	 время самого расчёта;


	- в [приёмниках
	 данных](../Desktop/Calculation_block/Master_calculation_block_page_consumer.htm) блока расчёта содержатся [параметры](../Web/Calculation_block/Parameters.htm).
	 В этом случае при использовании многопоточного расчёта на этапе инициализации
	 для каждого потока, помимо коллекции отметок измерений [источников
	 данных](../Desktop/Calculation_block/Page_Sources.htm), создаётся также коллекция параметров для расчёта. Из-за
	 этого этап инициализации значительно замедляется и общее время многопоточного
	 расчёта может превысить общее время однопоточного расчёта;


	- при задании фильтрации по данным в блоке расчёта количество
	 рассчитываемых точек в источниках данных меньше количества потоков.
	 Подробнее описано в подразделе «[Многопоточный
	 расчёт с настроенной фильтрацией по данным](#multithread)».


Если блок расчёта содержит [формулы](../Desktop/Calculation_block/Formula.htm),
 вычисления которых выполняются в течение длительного времени, и количество
 итераций в формулах превышает число потоков, то используйте многопоточный
 расчёт для увеличения производительности и ускорения расчёта блока за
 счёт параллельного расчёта итераций. Многопоточный расчёт доступен на
 системах с многоядерными процессорами: число потоков равно числу ядер
 процессора.


Примечание.
 Использование многопоточного расчёта для [блока
 расчёта](../Desktop/Calculation_block/Calculation_unit.htm) или [блока
 контроля](../Desktop/Control_Block/Control_Block.htm) доступно только при отметке хотя бы одного измерения [приёмника
 данных](../Desktop/Calculation_block/Master_calculation_block_page_consumer.htm).


## Многопоточный расчёт с настроенной фильтрацией
 по данным


В случае совпадения одного из кубов-источников с кубом-приёмником [блока расчёта](../Desktop/Calculation_block/Calculation_unit.htm)
 при [настройке
 фильтрации по данным](../Desktop/Calculation_block/FilteringByData.htm) флажок «Многопоточный
 расчет» на странице «[Приёмник](../Desktop/Calculation_block/Master_calculation_block_page_consumer.htm)»
 в мастере редактирования [блока
 расчёта](../Desktop/Calculation_block/Calculation_unit.htm) и флажок «Многопоточный расчет»
 в окне «[Настройка
 выполнения расчёта](../Desktop/Work/Perform_calculations.htm)» будут проигнорированы и расчёт будет выполняться
 в однопоточном режиме. В противном случае многопоточный расчёт будет выполняться
 в соответствии с установленными флажками.


При заданной [фильтрации
 по данным](../Desktop/Calculation_block/FilteringByData.htm) многопоточный расчёт будет происходить по данным в источниках,
 а не по отметке. Соответственно, разбиение по потокам будет происходить
 по точкам с данными в источниках. Производительность расчёта в этом случае
 будет зависеть от количества точек данных, изменяемых при расчёте. Если
 количество изменяемых точек данных будет меньше количества потоков, то
 многопоточный расчёт будет выполняться медленнее по сравнению с однопоточным,
 поскольку инициализация нескольких потоков требует дополнительного времени.


См. также:


[Вопросы и ответы](FAQ_CalculationAlgorithm.htm) |
 [Расчёт
 алгоритма](../Desktop/Work/Perform_calculations.htm) | [Выбор
 и настройка приёмника данных](../Desktop/Calculation_block/Master_calculation_block_page_consumer.htm)


		Справочная
		 система на версию 10.9
		 от 18/08/2025,
		 © ООО «ФОРСАЙТ»,
