# Настройка агрегации: Блок агрегации, веб-приложение

Настройка агрегации: Блок агрегации, веб-приложение
-


# Настройка агрегации


Настройка агрегации определяет, по каким измерениям будут агрегированы
 данные и каким методом.


Настройка агрегации выполняется на странице «Агрегация»
 в [мастере редактирования блока агрегации](Aggregation_block.htm):


![](AggregationSetup.png)


Для настройки агрегации измерения:


	- Выберите агрегируемое измерение.


	- Нажмите кнопку ![](../Calculation_block/edit.png) «Редактировать». Будет открыт диалог
	 «[<наименование измерения> - Основной механизм агрегации](#aggrmethod)»,
	 в котором задайте параметры агрегации измерения.


	- Если для измерения настроена [альтернативная
	 иерархия](UiNavObj.chm::/reference_book/UiMd_reference_book_Hierarchy.htm#alternativehierarchy), то при необходимости выберите альтернативную
	 иерархию для расчёта по элементам альтернативного справочника вместо
	 элементов исходного справочника или настройте динамический выбор альтернативной
	 иерархии в зависимости от атрибута параметра, указав вариант альтернативной
	 иерархии в окне «Настройка альтернативной
	 иерархии». Напротив измерений с альтернативными иерархиями
	 отображается пиктограмма ![](AlterH_off.png).


[![](../../Opened.gif)![](../../Closed.gif)Для
 открытия окна](javascript:TextPopup(this))


			- Выделите измерение, в котором содержатся [альтернативные
			 иерархии](UiNavObj.chm::/reference_book/UiMd_reference_book_Hierarchy.htm#alternativehierarchy).


			- Нажмите кнопку ![](AlterH_off.png) «Альтернативная
			 иерархия».


![](AlternativeHierarchies.png)


Выберите тип альтернативной иерархии с помощью
 переключателей:


		- Фиксированная.
		 Источником альтернативной иерархии является справочник. Выберите
		 доступный справочник в раскрывающемся списке. Доступен выбор только
		 одного справочника;


		- Динамическая.
		 Источником альтернативной иерархии является [параметр](ParametersArrg.htm).
		 Выберите атрибут [параметра](ParametersArrg.htm) блока
		 агрегации в раскрывающемся списке. При динамическом выборе альтернативной
		 иерархии данные в [приёмнике](Aggregation_block_Receiver.htm)
		 будут изменяться в зависимости от выбранного значения атрибута.
		 Если значение атрибута выбранного элемента в параметре не является
		 ключом альтернативной иерархии, то будет выведено соответствующее
		 сообщение;


		- Не
		 применяется. По умолчанию. Альтернативная иерархия не используется.


При выборе фиксированной или динамической
 альтернативной иерархии напротив измерения будет отображена пиктограмма ![](AlterH.png).


В результате будет настроена агрегация измерения. Если требуется, то
 аналогичным образом настройте агрегацию для следующего измерения.


Для удаления выделенных настроек агрегации нажмите кнопку ![](../Calculation_block/delete.png) «Удалить».


## Настройка агрегации измерения


Для настройки параметров агрегации измерения используйте диалог «<наименование
 измерения> - Основной механизм
 агрегации»:


![](AggregationMethod.png)


Порядок настройки:


	- Определите элементы измерения, участвующие в агрегации. По умолчанию
	 флажок «Агрегировать отмеченные элементы
	 в измерении» установлен. Если флажок установлен, то агрегация
	 будет выполняться по элементам, отмеченным на странице «[Приёмник](Aggregation_block_Receiver.htm)». При множественной
	 отметке элементов измерения и снятом флажке агрегация будет выполняться
	 по всем элементам измерения. При единичной отметке родительского элемента
	 и снятом флажке агрегация выполняется по дочерним элементам.


Примечание.
 Если в настройках агрегации измерения куба установлен флажок «[Агрегировать
 отмеченные элементы в измерении](uinavobj.chm::/cube/work_cube/tuning_agr/uimd_cube_work_cube_tuning_agr_basic.htm)»,
 то при расчёте блока агрегации данные в родительском элементе будут удваиваться
 за счёт выполнения агрегации из куба.


	- Выберите уровень-приёмник в измерении, для которого настраивается
	 агрегация. Используйте раскрывающийся список «Уровень-приёмник».
	 Если в качестве уровня выбран элемент «[Все
	 уровни]», то агрегация будет настроена для всех уровней, в
	 том числе и для тех, которые могут появиться позже.


	- Задайте метод агрегации в раскрывающемся списке «Метод
	 агрегации». Для подробного описания доступных методов агрегации
	 обратитесь к разделу «[Методы агрегации](#methods)».


	- Задайте уровни-источники для агрегации.

	Для автоматического определения уровней-источников установите флажок
	 «Автоматически определять уровни-источники
	 (дочерние элементы)».

	Для определения уровней-источников вручную убедитесь, что флажок «Автоматически определять уровни-источники
	 (дочерние элементы)» снят и отметьте флажками все необходимые
	 уровни.

	Если настройка агрегации выполняется для всех уровней, то уровни-источники
	 всегда определяются автоматически.


	- Определите метод сохранения агрегированных данных на уровне-приёмнике.
	 Используйте группу переключателей «Сохранять
	 агрегированные данные»:


		- Всегда. Агрегированные
		 данные всегда будут записываться на уровень-приёмник;


		- Только когда нет данных.
		 Агрегированные данные будут записаны на уровень-приёмник, если
		 на уровне-приёмнике нет данных;


		- Только когда результат
		 непустой. Агрегированные данные будут записаны на уровень-приёмник,
		 только если результат агрегации непустой.


	- Определите метод обработки пустых значений. Используйте группу
	 переключателей «Обработка пустых
	 значений»:


		- Участвуют в агрегации.
		 Пустые значения будут участвовать в агрегации;


		- Только когда родитель непустой.
		 Пустые значения будут участвовать в агрегации, если родительский
		 элемент непустой. Если результат агрегации по дочерним элементам
		 равен пустому значению и при этом в родительском элементе уже
		 имеется значение, то оно будет заменено пустым значением;


		- Не участвуют в агрегации.
		 Пустые значения не будут участвовать в агрегации.


	- Определите, учитывать ли при расчёте агрегации значение уровня-приёмника.
	 По умолчанию агрегация рассчитывается с учётом значения уровня приёмника.
	 Если данное значение необходимо исключить из агрегации, то снимите
	 флажок «Учитывать значение во владельце».


В результате будет настроена агрегация для выбранного измерения.


### Особенности расчёта агрегации


Если в отметке присутствуют разрывы, то агрегация рассчитывается с прыжком
 на уровень. Разрыв в отметке - это когда отмечены дочерние элементы, но
 не отмечен их родительский элемент В таком случае данные дочерних элементов
 неотмеченного родительского элемента используются для расчета следующего
 родительского элемента.


Например, есть иерархия, в которой с разрывом отмечены элементы:


![](MatrixAggregationExpl.png)


Агрегация с прыжком на уровень будет рассчитываться следующим образом:


		 Шаг
		 Установлен флажок «Учитывать
		 значение во владельце»
		 Снят флажок «Учитывать значение
		 во владельце»


		 Выполняется расчёт на нижем уровне


		 Item 1.1 = Item 1.1 + item 1.1.1 + item 1.1.2
		 Item 1.1 = item 1.1.1 + item 1.1.2


		 Вычисляется значение верхнего уровня


		 Item 2 = Item 2+ item 2.1.1 + 2.1.2
		 Item 2 = item 2.1.1 + 2.1.2


		 Item 3 = Item 3 + item 3.1.1
		 Item 3 = item 3.1.1


		 Вычисляется значение для корневого
		 элемента


		 Root = Root + item 1.1 + item 1.3 + item 2 + item 3
		 Root = item 1.1 + item 1.3 + item 2 + item 3


### Методы агрегации


Для агрегации измерения в модели матричной агрегации доступны следующие
 методы:


	- Нет. Агрегация не производится;


	- Сумма. Суммируются элементы
	 уровня-источника;


	- Минимум. На уровне-источнике
	 выбирается минимальное значение;


	- Максимум. На уровне-источнике
	 выбирается максимальное значение;


	- Количество непустых.
	 Определяется количество непустых значений на уровне-источнике;


	- Количество пустых. Определяется
	 количество пустых значений на уровне-источнике;


	- Количество всех дочерних.
	 Определяется количество дочерних элементов на уровне-источнике;


	- Арифметическое среднее.
	 Определяется среднее значение элементов уровня с учетом пустых значений;


	- Фактическое среднее.
	 Определяется среднее значение элементов уровня без учета пустых значений;


	- Первое фактическое.
	 На уровне-источнике берется первое имеющееся (фактическое) значение;


	- Последнее фактическое.
	 На уровне-источнике берется последнее имеющееся (фактическое) значение;


	- Среднеквадратическое отклонение
	 по выборке. Определяется среднеквадратическое отклонение ряда
	 по выборке;


	- Медиана. Определяется
	 медиана для значений на уровне-источнике;


	- Среднеквадратическое отклонение.
	 Определяется среднеквадратическое отклонение ряда по генеральной совокупности;


	- Количество различных значений.
	 Определяется количество уникальных значений на уровне-источнике.


См. также:


[Вставка и настройка блоков агрегации](Aggregation_block.htm)


		Справочная
		 система на версию 10.9
		 от 18/08/2025,
		 © ООО «ФОРСАЙТ»,
