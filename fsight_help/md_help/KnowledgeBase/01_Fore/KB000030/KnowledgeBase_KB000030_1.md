# Расширенное логирование и получение дополнительной отладочной информации

Расширенное логирование и получение дополнительной отладочной информации
-


# Расширенное логирование и получение дополнительной отладочной информации


## Введение


	Во время работы в «Форсайт. Аналитическая платформа»
	 ядром формируется и выводится отладочная информация.


	Для просмотра отладочной информации используйте:


		- поток ошибок stderr в ОС Linux;


		- [syslog](https://ru.wikipedia.org/wiki/Syslog)
		 в ОС Linux;


		- Debugger в ОС Windows, который можно просмотреть через специализированную
		 программу, например, [DebugView](https://learn.microsoft.com/en-us/sysinternals/downloads/debugview). DebugView
		 входит в пакет программ [Sysinternals](https://learn.microsoft.com/en-us/sysinternals/downloads/).


	По умолчанию отладочная информация нигде не сохраняется. В некоторых
	 случаях она может потребоваться для выяснения причин возникновения
	 каких-либо ошибок. Для этого предусмотрена возможность вывода отладочной
	 информации в файл. Настройки по логированию отладочной информации
	 хранятся в реестре операционной системы. Необходимо
	 помнить, что включение вывода отладочной информации в файл приведет
	 к замедлению работы среды разработки и прикладных модулей/форм, поэтому
	 указанные ниже параметры необходимо убирать после того, как исследование
	 проблемы завершено и необходимость в логе отсутствует.


	При работе с BI-сервером в ОС Linux используйте раздел реестра [HKEY_LOCAL_MACHINE].
	 При работе с BI-сервером/настольным приложением в ОС Windows задайте
	 настройки для всех пользователей операционной системы в разделе реестра
	 [HKEY_LOCAL_MACHINE] или только для текущего пользователя в разделе
	 реестра [HKEY_CURRENT_USER].


## Лог работы


	Для вывода отладочной информации создайте раздел Log
	 в ветке реестра [HKEY_LOCAL_MACHINE\Software\Foresight\Foresight Analytics Platform\10.0] со следующими параметрами:


			 Параметры
			 Описание


			 FileName
			 Строковый параметр, содержащий путь и наименование файла,
			 в который будет выводиться отладочная информация. Уровень
			 логирования определяется в параметре SeverityLevel.


			 IsolatedByDate
			 Параметр типа REG_DWORD, указывающий необходимость разбиения
			 файла по датам.

Допустимые значения:


				- 0. По умолчанию.
				 Отладочная информация сохраняется в один файл, указанный
				 в параметре FileName;


				- 1. Отладочная
				 информация сохраняется в разные файлы. Каждый день создаётся
				 новый файл для записи отладочной информации. Текущая дата
				 добавляется к имени файла.


			Используется совместно с параметром FileName.


			 SeverityLevel
			 Параметр типа REG_DWORD, содержащий уровень логирования.


Допустимые значения:


				- 0. Уровень
				 логирования - Trace. Фиксируется вся отладочная информация,
				 генерируемая в ядре платформы;


			Важно.
			 Фиксация всей отладочной информации влияет на производительность
			 платформы и значительно увеличивает объём отладочной информации
			 в файле.


				- 1. Уровень
				 логирования - Debug. Дополнительно к уровню Info фиксируются
				 SQL-запросы и их параметры, информация об аутентификации
				 пользователей по протоколу LDAP, если используется [доменная/интегрированная
				 доменная аутентификация](Setup.chm::/UiWebSetup/Authentication/Domain_Authentication_Apache.htm);


				- 2. По умолчанию.
				 Уровень логирования - Info. Основной способ вывода отладочной
				 информации, включающий в себя уровень Warning и информацию
				 о длительности выполнения операций, загрузке/выгрузке
				 библиотек, информационные сообщения, генерируемые платформой;


				- 3. Уровень
				 логирования - Warning. Дополнительно к уровню Error фиксируются
				 предупреждения;


				- 4. Уровень
				 логирования - Error. Дополнительно к уровню Critical фиксируются
				 ошибки;


				- 5. Уровень
				 логирования - Critical. Фиксируются только критичные ошибки.


			Используется, если задан один из параметров: WriteToDebugOutput
			 со значением «1»; WriteToSyslog
			 со значением «1»; FileName.


			 WriteToDebugOutput
			 Параметр типа REG_DWORD, определяющий доступность вывода
			 отладочной информации в поток ошибок stderr в ОС Linux или
			 Debugger в ОС Windows.

Допустимые значения:


				- 0. По умолчанию.
				 Выводятся отладочные сообщения о загружаемых и выгружаемых
				 библиотеках;


				- 1. В дополнение
				 к содержимому, выводимому при значении параметра «0»,
				 выводится отладочная информация, соответствующая уровню
				 логирования, заданному в параметре SeverityLevel.


			 WriteToSyslog
			 Параметр типа REG_DWORD, определяющий доступность вывода
			 отладочной информации в [syslog](https://ru.wikipedia.org/wiki/Syslog) в ОС
			 Linux. Отладочная информация формируется с категорией «fp-log».


Допустимые значения:


				- 0. По умолчанию.
				 Отладочная информация не выводится в syslog;


				- 1. Отладочная
				 информация выводится в syslog. Уровень логирования определяется
				 в параметре SeverityLevel.


			 SymbolWrapperMode
			 Параметр типа REG_DWORD, определяющий признак экранирования
			 символов переноса строки (\r\n\v) на их эквивалентное текстовое
			 представление в виде escape-последовательностей. Используется
			 для преобразования многострочной информации в одну строку,
			 например, при выполнении SQL-запросов с параметрами.


			Допустимые значения:


				- 0. Экранирование
				 не используется;


				- 1. По умолчанию.
				 Символы переноса строки (\r\n\v) заменяются на их эквивалентное
				 текстовое представление.


	Параметры являются необязательными. Если какой-либо из параметров
	 отсутствует в реестре, то используется его значение по умолчанию.


	Примечание.
	 Параметры FileName, WriteToDebugOutput, WriteToSyslog
	 не зависят друг от друга. Например, в ОС Linux отладочная информация
	 может одновременно сохраняться в файл, выводиться в поток ошибок stderr
	 и syslog.


	У пользователя, под которым работает BI-сервер/настольное приложение,
	 должны быть права на изменение файла с отладочной информацией.


		ОС
		 Linux ОС
		 Windows

			При работе в ОС Linux используйте следующие команды:


				- Сделайте www-data владельцем создаваемого файла,
				 например:


			sudo chown
			 www-data:www-data /var/log/mydir/myfile.log


				- Раздайте права на запись владельцу и только чтение
				 для всех остальных пользователей:


			sudo chmod
			 u=rw,g=r,o=r /var/log/mydir/myfile.log


			Указанный пример применим для раздачи прав в Debian-подобных
			 дистрибутивах. При работе в других дистрибутивах ОС Linux
			 замените «www-data:www-data» на «apache:apache» для RedHat-подобных
			 дистрибутивов или на «apache2:apache2» для ALT Linux.


			В ОС Windows, при необходимости, права можно настроить в
			 свойствах файла.


	Для вывода дополнительной отладочной информации [среды разработки](developer.chm::/Desktop_Title.htm)
	 и [планировщика
	 задач](uiappsrv.chm::/UiAppSrv_purpose.htm)
	 внесите изменения в реестре, указанные ниже. ».


## Отладочная информация среды разработки


	Отладочная информация может использоваться для выявления ошибок,
	 в результате которых могут возникать [утечки
	 памяти](UiDevEnv.chm::/01_Development_Environment/02_Work_in_Development_Environment/detecting_leaks.htm). Для фиксации в файле отладочной информации,
	 которую генерирует ядро среды разработки, внесите изменения в реестр:


		- Убедитесь, что в реестре содержится раздел [Log](#log)
		 с параметрами FileName
		 и SeverityLevel.


	Примечание.
	 Отладочная информация среды разработки выводится, если для параметра
	 SeverityLevel установлено
	 значение «0», «1» или «2». Дополнительно фиксируются SQL-запросы к
	 системным таблицам репозитория, которые формируются при обращении
	 к объектам репозитория.


		- Добавьте следующие параметры:


			- в ветке [HKEY_LOCAL_MACHINE\Software\Foresight\Foresight Analytics Platform\10.0\Debug] создайте
			 параметр GCTrace типа
			 REG_DWORD со значением «1». Параметр предназначен для регистрации
			 всех сообщений сборщика мусора;


			- в ветке [HKEY_LOCAL_MACHINE\Software\Foresight\Foresight Analytics Platform\10.0\DevEnv]
			 создайте параметры типа REG_DWORD и установите им значение
			 «1»:


				- DevEnvDebug.
				 Фиксация информации о создании компонентов;


				- DevEnvParserDebug.
				 Фиксация информации парсера среды разработки.


			- в ветке [HKEY_LOCAL_MACHINE\Software\Foresight\Foresight Analytics Platform\10.0\Fore] создайте
			 параметры:


				- CheckLeaks.
				 Параметр типа REG_DWORD включает проверку наличия утечек
				 памяти при закрытии репозитория в настольном приложении.
				 Для включения проверки установите параметру значение «1». Если есть утечки,
				 то будет выведен диалог сохранения утечек в файл;


				- LeaksGraphFile.
				 Путь и наименование файла, в который будут сохраняться
				 список утечек памяти при закрытии репозитория. Если параметр
				 задан, то диалог не выводится, а происходит сохранение
				 в указанный файл. Файл создаётся в формате TGF (trivial
				 graph format);


				- ExternRefLogging.
				 Параметр типа REG_DWORD включает логирование изменения
				 внешних ссылок при входе в репозиторий;


				- ExtRefChangesFile.
				 Путь и наименование файла, в который будет сохраняться
				 лог изменения внешних ссылок объектов при закрытии репозитория.
				 Файл создаётся в формате TXT.


## Отладочная информация планировщика задач


	Для фиксации в файле отладочной информации, которая генерируется
	 в процессе работы планировщика задач, внесите изменения в реестр.


	Важно.
	 Планировщик и [BI-сервер](Setup.chm::/UiWebSetup/UiWebSetup_TitlePage.htm)
	 необходимо запускать на разных серверах.


		 ОС
		 Linux

		 ОС
		 Windows


			По умолчанию вывод отладочной информации в ОС Linux производится
			 в файл /var/log/syslog при значении [PP_LOG=1](UiAppSrv.chm::/1_Work_AppSrv/UiAppSrv_Work_AppSrv_Service.htm)
			 в файле службы планировщика.


			Для переопределения расположения файла отладочной информации
			 и его наименования в ОС Linux:


				- Создайте конфигурационный файл для настройки файлов
				 реестра с расширением *.reg, например:


			[HKEY_LOCAL_MACHINE\SOFTWARE\Foresight\Foresight
			 Analytics Platform\10.0\Scheduler]


			"Trace"=dword:00000003


			[HKEY_LOCAL_MACHINE\SOFTWARE\Foresight\Foresight
			 Analytics Platform\10.0\Log]


			"FileName"="/var/log/Scheduler/name_for_log.log"


			"SeverityLevel"=dword:00000003


			Где:


					- Trace.
					 Фиксация информации о задачах контейнера. Параметр
					 типа REG_DWORD со значением «3» в разделе Scheduler
					 ветки реестра [HKEY_LOCAL_MACHINE\Software\Foresight\Foresight Analytics Platform\10.0];


					- FileName
					 и SeverityLevel в
					 разделе [Log](KnowledgeBase_KB000030_1.htm#filename)
					 в ветке реестра [HKEY_LOCAL_MACHINE\Software\Foresight\Foresight Analytics Platform\10.0].


				- Разместите файл по адресу /opt/foresight/fp10.x-biserver/etc/registry/.


				- Убедитесь, что значение PP_LOG=0 в файле службы
				 планировщика.


				- Убедитесь, что в реестре содержится раздел [Log](#log)
				 с параметрами FileName
				 и SeverityLevel.


				- Создайте раздел Scheduler в ветке реестра [HKEY_LOCAL_MACHINE\Software\Foresight\Foresight Analytics Platform\10.0], если
				 он отсутствует.


				- В разделе Scheduler создайте параметр Trace
				 типа REG_DWORD со значением «3». Параметр предназначен
				 для фиксации информации о задачах контейнера.


См. также:


[Дополнительные
 настройки среды разработки](../KnowledgeBase_KB000030.htm) | [Работа
 с отладочной информацией](UiDevEnv.chm::/01_Development_Environment/02_Work_in_Development_Environment/Debugging/working_with_debugging_information.htm)


		Справочная
		 система на версию 10.9
		 от 18/08/2025,
		 © ООО «ФОРСАЙТ»,
