# Эффективное построение и использование справочников

Эффективное построение и использование справочников
-


# Эффективное построение и использование справочников


	Номер статьи: KB000014


## Общие сведения


	Связанные блоки:


		- [Справочники](UiNavObj.chm::/reference_book/Create.htm)


		- [Сборка
		 Dimensions](kedims.chm::/kedims_title.htm)


## Описание


	При создании и использовании справочников в «Форсайт. Аналитическая платформа»
	 достаточно часто допускаются типовые ошибки, которые приводят к неэффективной
	 работе приложения и использованию платформы.


## Ошибка 1


	Справочник строится на базе таблицы, содержащей большое количество
	 записей. При этом, в справочник в качестве элементов включается лишь
	 незначительная часть записей.


	Таким образом, при построении справочника происходит извлечение
	 на клиентскую рабочую станцию всех записей таблицы, которые затем
	 фильтруются либо пользовательским фильтром, либо разработчиком, строящим
	 справочник. Данная ситуация довольно часто встречается, когда в одной
	 таблице хранятся данные, отличающиеся значением какого-либо поля,
	 сразу для нескольких справочников.


	Извлечение большого количества записей - это длительный процесс.
	 Проблема может усугубиться при нехватке оперативной памяти. На фильтрацию
	 большого количества записей также требуется время. Оба этих фактора
	 приводят к значительному увеличению времени на открытие справочника.


### Решение


	Построение справочника на базе запроса, который отфильтровывает
	 лишь необходимые записи из таблицы. Запрос может быть параметрическим
	 и управляться из справочника. Таким образом, на несколько справочников
	 можно использовать один запрос. Фильтрация данных на сервере позволяет
	 существенно ускорить процесс построения справочника.


## Ошибка 2


	Использование фильтра в справочнике вместо фильтрации данных на
	 уровне запроса.


	Есть параметрический справочник. В справочник надо включать только
	 те элементы, значение определенного атрибута которых равно значению
	 параметра. Часто в этом случае в справочнике применяется фильтр:
	 равенство значения (атрибута значению параметра. В случае большого
	 количества элементов на проверку условия тратится значительное количество
	 времени, т.к. для каждой записи исходной таблицы (запроса) вычисляется
	 выражение на Fore.


### Решение


	Построение справочника на запросе подобно тому, как это описано
	 выше. Единственное отличие в этом случае будет то, что параметр справочника
	 будет управлять параметром запроса.


	Фильтр в справочнике рекомендуется применять лишь для нетривиальных
	 способов фильтрации, в остальных случаях предпочтительнее использовать
	 фильтрацию на уровне запроса к БД.


## Кеширование данных справочников


	Ядро платформы производит кеширование справочников, в том числе
	 параметрических. Если в прикладной системе один и тот же справочник
	 с большим количеством элементов (атрибутов) открывается много раз
	 с различными значениями параметров, то это может приводить к значительному
	 расходу памяти на хранение кешированных экземпляров. Если для управления
	 справочником используются параметры с типом «Дата», то значение параметров
	 необходимо передавать без компоненты времени (значение компоненты
	 времени должно быть установлено по умолчанию - 00:00).


	Данный момент надо учитывать при разработке прикладных систем. Если
	 все же существует необходимость постоянного переоткрытия справочников,
	 то после их закрытия желательно очищать кеш соответствующего объекта,
	 либо всего репозитория. В ядре платформы реализованы различные средства
	 для управления кешем:


		- [IMetabase.Cache](kesom.chm::/interface/imetabase/imetabase.cache.htm)
		 - доступ к кешу репозитория. Используя методы доступные для кеша
		 репозитория можно осуществить очистку кешированных данных как
		 отдельных объектов, так и всего репозитория. Также можно получить
		 кешированные данные определенных объектов.


		- [IMetabaseObject.FlushInstance](kesom.chm::/interface/imetabaseobject/imetabaseobject.flushinstance.htm)
		 и [IMetabaseObject.FlushInstances](kesom.chm::/interface/imetabaseobject/imetabaseobject.flushinstances.htm)
		 - методы, позволяющие очистить кеш отдельного объекта репозитория.


См. также:


[База
 знаний разработчиков](../KnowledgeBase_Intro.htm) | [IMetabase.Cache](kesom.chm::/interface/imetabase/imetabase.cache.htm)
 | [IMetabaseObject.FlushInstance](kesom.chm::/interface/imetabaseobject/imetabaseobject.flushinstance.htm)
 | [IMetabaseObject.FlushInstances](kesom.chm::/interface/imetabaseobject/imetabaseobject.flushinstances.htm)


		Справочная
		 система на версию 10.9
		 от 18/08/2025,
		 © ООО «ФОРСАЙТ»,
